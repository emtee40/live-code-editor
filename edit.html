<!DOCTYPE html>
<title>Live HTML Editor</title>
<style>
#editor {
	position: absolute;
	top: 0;
	right: 0;
	bottom: 0;
	left: 0;
}
</style>
<div id="editor">&lt;!DOCTYPE html&gt;
&lt;p&gt; Welcome to the real-time HTML editor. Type HTML in the textarea above, and it will appear in a frame below.	</div>
<script src="https://cdn.jsdelivr.net/ace/1.1.9/min/ace.js"></script>
<script>
function safeHTML(text) {
	// The exact name doesn't matter
	var div = document.createElement('div')
	div.appendChild(document.createTextNode(text))
	return div.innerHTML
}
function onChange() {
	var previewFrame = top.preview
	var document = previewFrame.document
	document.open()
	// Shouldn't occur in theory.
	if (!previewFrame.console) {
		previewFrame.console = {}
	}
	var previousConsoleLog = previewFrame.console.log || function () {}
	previewFrame.console.log = function log() {
		for (var i = 0; i < arguments.length; i++) {
			var argument = arguments[i]
			var safe
			var uneval = window.uneval || function uneval(value) {
				return value
			}
			try {
				safe = safeHTML(uneval(argument))
			}
			catch (e) {
				try {
					safe = safeHTML(e)
				}
				// If you insist...
				catch (e) {
					safe = 'Exception while processing exception yo dawg?'
				}
			}
			document.write('<pre>' + safe + '</pre>')
		}
		// Show result on console as well
		previousConsoleLog.apply(this, arguments)
	}
	previewFrame.onerror = function onerror(e) {
		previewFrame.console.log(e)
	}
	document.write(editor.getSession().getValue())
	document.close()
}
var timeout = null
function debounceChanges() {
	if (timeout) {
		clearTimeout(timeout)
	}
	timeout = setTimeout(function callOnChange() {
		onChange()
		timeout = null
	}, 300)
}
var editor = ace.edit('editor')
editor.getSession().setMode("ace/mode/html")
editor.on('change', debounceChanges)
onChange()
</script>
