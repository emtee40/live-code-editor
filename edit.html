<!DOCTYPE html>
<title>Live HTML Editor</title>
<style>
  body {
    margin: 0;
  }
  .cm-editor {
    height: 100vh;
  }
</style>
<script type="module">
  import { EditorState, EditorView, basicSetup } from "@codemirror/basic-setup";
  import { html } from "@codemirror/lang-html";
  function onChange() {
    var previewFrame = top.preview;
    var document = previewFrame.document;
    document.open();
    document.write(editor.state.doc);
    document.close();
  }
  var timeout = null;
  function debounceChanges() {
    if (timeout) {
      clearTimeout(timeout);
    }
    timeout = setTimeout(function callOnChange() {
      onChange();
    }, 300);
  }
  const editor = new EditorView({
    state: EditorState.create({
      doc:
        "<!DOCTYPE html>\n" +
        "<p> Welcome to the real-time HTML editor. Type HTML in " +
        "the textarea above, and it will appear in a frame below.",
      extensions: [
        basicSetup,
        html(),
        EditorView.updateListener.of((update) => {
          if (update.docChanged) debounceChanges();
        }),
      ],
    }),
    parent: document.body,
  });
  onChange();
</script>
